FROM consul:1.14.5

ENV KEYCLOAK_AUTHSERVERURL=http://keycloak:8080/auth \
    CONSUL_MASTER_TOKEN=AutoGenerated \
    CONSUL_ADVERTISE=

COPY startup.sh /opt/startup.sh
COPY config/* /consul/config/

RUN apk update && \
    apk upgrade && \
    apk add bash jq pwgen && \
    chmod +x /opt/startup.sh

CMD [ "/opt/startup.sh" ]
